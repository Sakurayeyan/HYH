$("document").ready(function () {
    // const id = Math.ceil(Math.random()*100);
    const id = window.location.search.split("id=")[1].split("&")[0].split("%")[0];
    let RooName;
    let StartEndTime;
    let UserName;
    let Numbers;
    let Position;
    let Contact;

    function loadusesr() {
        $.ajax({
            type:"GET",
            url:"http://140.143.6.117:3000/GetUserData",
            data:{
                id:id,
            },
            success:function (res) {
                console.log(res)
                StartEndTime = res.StartTime.split("T")[1].split(".")[0]+'-'+res.EndTime.split("T")[1].split(".")[0];
                UserName = res.Applicant;
                Numbers = res.Number;
                Position = res.Position;
                Contact = res.Contact;
                $(".StartEndTime").text(StartEndTime);
                $(".Numbers").text(Numbers);
                var MeetingRoomID = res.MeetingRoomID;
                $.ajax({
                    type:"GET",
                    url:"http://140.143.6.117:3000/GetMeetingRoom",
                    data:{
                        MeetingRoomID:MeetingRoomID,
                    },
                    success:function(res){
                        $(".MeetingRoomID").text(res.RoomName);
                        RooName = res.RoomName;
                    }
                })
            }

        })
    }
    function Userhistory() {
        $.ajax({
            type:"GET",
            url:"http://140.143.6.117:3000/Userhistory",
            data:{
                id:id,
            },
            success:function (res) {
                console.log(typeof res)
                    $("#history-waterval").children(".demand-num").text(res.Water);
                    $("#history-teaval").children(".demand-num").text(res.Tea);
                    $("#history-coffeeval").children(".demand-num").text(res.Coffee);
                    $("#history-penval").children(".demand-num").text(res.Pen);
                    $("#history-paperval").children(".demand-num").text(res.Paper);
                    $("#history-tea_cakeval").children(".demand-num").text(res.Tea_cake);
                    $("#history-failureval").children(".demand-num").text(res.Failure);
                    $("#history-The_screenval").children(".demand-num").text(res.The_screen);
                    $("#history-Lug_plateval").children(".demand-num").text(res.Lug_plate);
                    $("#history-adapterval").children(".demand-num").text(res.Adapter);
            }
        })
    }
    // 添加数目
    function AddorMinus(){
        $(".add").click(function () {
            var val_dom = $(this).parent().children(".AddService-box-item-num-value");
            var val = Number(val_dom.text());
            val_dom.addClass("text-color");
            $(this).parent().children(".AddService-box-item-num-value").text(val+1);
        })
        $(".minus").click(function () {
            var val_dom = $(this).parent().children(".AddService-box-item-num-value");
            var val = Number(val_dom.text());
            if(val>0){
                $(this).parent().children(".AddService-box-item-num-value").text(val-1);
                if(val==1){
                    val_dom.removeClass("text-color");
                }
            }else{
                val_dom.removeClass("text-color");
            }
        })
    }
    //获取数目
    function getNum() {
       water = Number($("#water").text());
       tea = Number($("#tea").text());
       coffee = Number($("#coffee").text());
       pen = Number($("#pen").text());
       paper = Number($("#paper").text());
       tea_cake = Number($("#tea_cake").text());
       failure = Number($("#failure").text());
       The_screen = Number($("#The_screen").text());
       Lug_plate = Number($("#Lug_plate").text());
       adapter = Number($("#adapter").text());
    }
    //判断数目是否为0
    function nonumber() {
        num = water+tea+coffee+pen+paper+tea_cake+failure+The_screen+Lug_plate+failure+adapter;
        if(num!=0){
            NoNumber = false;
        }else {
            NoNumber = true;
        }
    }
    //画面跳转
    function topage() {
        $("#page1").hide();
        $("#page2").slideDown();
        hide_0();
    }
    // 列表效果
    function hide_0(){
        $(".demand-box-ul li").hide() //隐藏所有li
        function judge(val,item,item_val) {if (val>0){$(item).show();$(item +' '+'.demand-num').text(val);}}
        judge(water,'#demand-waterval');
        judge(tea,'#demand-teaval');
        judge(coffee,'#demand-coffeeval');
        judge(pen,'#demand-penval');
        judge(paper,'#demand-paperval');
        judge(tea_cake,'#demand-tea_cakeval');
        judge(failure,'#demand-failureval');
        judge(The_screen,'#demand-The_screenval');
        judge(Lug_plate,'#demand-Lug_plateval');
        judge(adapter,'#demand-adapterval');
        $(".drop-down").click(function (){
            $(this).toggleClass("rotate-180");
            $(".history-box-ul li").each(function (i) {
                if(Number($(this).children(".demand-num").text())>0){
                    $(this).toggle();
                }
            });

        })// 下拉
    }
    // $(".historydown").click(function () {
    //     $(".history-box-ul").children("li").each(function (i) {
    //         if(Number($("this").eq(i).children(".demand-num").text())>0){
    //             $(this).eq(i).hide();
    //         }
    //     })
    // })

    //提交
    $(".AddService-submit").click(function () {
        getNum();
        nonumber();
        if(NoNumber == true){
            alert("您好没有选择哦");
            return false;
        }else{
            var InputDate = new Date().toLocaleString();
            var data = {
                id:id,
                water:water,
                tea,tea,
                coffee:coffee,
                pen:pen,
                paper:paper,
                tea_cake:tea_cake,
                failure:failure,
                The_screen:The_screen,
                Lug_plate:Lug_plate,
                failure:failure,
                adapter:adapter,
                InputDate:InputDate,
                RooName:RooName,
                StartEndTime:StartEndTime,
                UserName:UserName,
                Number:Numbers,
                Position:Position,
                Contact:Contact
            }

            $.ajax({
                type:"GET",
                url:"http://140.143.6.117:3000/AddData",
                data:data,
                success:function (res) {
                    console.log(res)
                    topage();
                },
                error:function (err) {
                    alert(JSON.stringify(err))
                }
            })
        }


    })

    //运行的方法
    AddorMinus();
    loadusesr();
    Userhistory();
})